name: build cpp

on:
  push:
    branches: [ "main", "vpn" ]
  pull_request:
    branches: [ "main" ]

  workflow_dispatch:

jobs:
  vpn:
    runs-on: vpn
    steps:
      - name: docker ps
        run: docker ps

      - name: docker stop
        run: docker stop wireguard

      - name: docker run vpn
        run: |
          docker run -d --rm \
            --name=wireguard \
            --cap-add=NET_ADMIN \
            -e PUID=1000 \
            -e PGID=1000 \
            -e TZ=Etc/UTC \
            -e SERVERURL=178.128.212.163 `#optional` \
            -e SERVERPORT=51820 `#optional` \
            -e PEERS=1 `#optional` \
            -e PEERDNS=auto `#optional` \
            -e INTERNAL_SUBNET=10.13.13.0 `#optional` \
            -e ALLOWEDIPS=0.0.0.0/0 `#optional` \
            -e PERSISTENTKEEPALIVE_PEERS= `#optional` \
            -e LOG_CONFS=true `#optional` \
            -p 51820:51820/udp \
            -v /path/to/appdata/config:/config \
            --sysctl="net.ipv4.conf.all.src_valid_mark=1" \
            --restart unless-stopped \
            linuxserver/wireguard

      - name: docker ps
        run: docker ps

#       - name: Upload a Build Artifact
#         uses: actions/upload-artifact@v3.1.2
#         with:
#           name: cpp_app_matrix
#           path: ${{ env.app_name }}
#           retention-days: 5
  
#   send_telegram:
#     name: send telegram
#     needs: build_matrix
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/download-artifact@v3
#         with:
#           name: cpp_app_matrix
#       - name: ls 
#         run: ls -la 
#       - name: send telegram message on push
#         uses: appleboy/telegram-action@master
#         with:
#           to: ${{ secrets.TELEGRAM_TO }}
#           token: ${{ secrets.TELEGRAM_TOKEN }}
#           document: hi_*.o
#           message: |
#             ${{ github.actor }} created commit:
#             Commit message: ${{ github.event.commits[0].message }}

#             Repository: ${{ github.repository }}

#             See changes: https://github.com/${{ github.repository }}/commit/${{github.sha}}
            
